<ng-container *ngIf="($props | async) as props">
    <div class="px-window pt-window">

        <!-- Personalized greeting -->
        <tsr-greeting [user]="props.user"></tsr-greeting>

        <!-- Socket connection status -->
        <ng-container *ngIf="props.connection?.status != 'disconnected' && props.connection?.reconnectAttempts > 0">
            <div class="py-row">
                <div class="flex flex-1 items-center justify-start w-full bg-warn p-3 rounded-sm border border-warn-light">
                    <div>
                        <p class="text-sm pb-2">Störung erkannt.</p>
                        <p class="text-sm">Derzeit kann keine zuverlässige Verbindung zum Soundcore-Service aufgebaut werden. 
                            Du wirst automatisch verbunden sobald der Service wieder erreichbar ist. ({{ props.connection?.reconnectAttempts ?? 0 }})
                        </p>
                    </div>
                </div>
            </div>
        </ng-container>

        <!-- Last listened to -->
        <div class="py-row" *ngIf="props.history.length > 0">
            <p class="opacity-70 font-light pb-2 tracking-wide">Zuletzt gehört</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 grid-rows-1 gap-4">
                <tsr-channel-historical 
                    *ngFor="let channel of props.history" 
                    [channel]="channel"
                    [selected]="channel?.id === props.currentChannel?.id"
                    [playing]="props.isPlaying"
                    [loading]="props.isLoading"
                    (select)="forcePlay(channel)">
                </tsr-channel-historical>
            </div>
        </div>

        <div class="py-row" *ngIf="props.featured.length > 0">
            <p class="opacity-70 font-light pb-2 tracking-wide">Empfohlen</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 grid-rows-1 gap-4">
                <tsr-channel-historical 
                    *ngFor="let channel of props.featured" 
                    [channel]="channel"
                    [selected]="channel?.id === props.currentChannel?.id"
                    [playing]="props.isPlaying"
                    [loading]="props.isLoading"
                    (select)="forcePlay(channel)">
                </tsr-channel-historical>
            </div>
        </div>

        <div class="py-row" *ngIf="props.channels.length > 0">
            <p class="opacity-70 font-light pb-2 tracking-wide">Weitere Channels</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 grid-rows-1 gap-4">
                <tsr-channel-historical 
                    *ngFor="let channel of props.channels" 
                    [channel]="channel"
                    [selected]="channel?.id === props.currentChannel?.id"
                    [playing]="props.isPlaying"
                    [loading]="props.isLoading"
                    (select)="forcePlay(channel)">
                </tsr-channel-historical>
            </div>
        </div>
    </div>
</ng-container>

<ng-template #loadingHistory>
    <div class="py-row pointer-events-none">
        <p class="opacity-70 font-light mb-2 tracking-wide w-48 bg-body-light rounded-sm text-transparent text-opacity-0 animate-pulse">_</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 grid-rows-1 gap-4">
            <tsr-channel-historical></tsr-channel-historical>
            <tsr-channel-historical></tsr-channel-historical>
            <tsr-channel-historical></tsr-channel-historical>
        </div>
    </div>
</ng-template>

<ng-template #loadingList>
    <div class="py-row pointer-events-none">
        <p class="opacity-70 font-light mb-2 tracking-wide w-48 bg-body-light rounded-sm text-transparent text-opacity-0 animate-pulse">_</p>
        <div class="grid grid-cols-1 md:grid-cols-2 grid-rows-1 gap-4">
            <tsr-channel-historical></tsr-channel-historical>
            <tsr-channel-historical></tsr-channel-historical>
            <tsr-channel-historical></tsr-channel-historical>
        </div>
    </div>
</ng-template>